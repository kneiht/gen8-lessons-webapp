<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Grammar Test: Present Simple, Modals, Likes/Dislikes, Comparatives</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @media print {
        .print\:hidden {
          display: none !important;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <div
      class="test-paper max-w-3xl mx-auto bg-white shadow-lg print:shadow-none rounded-lg p-8 mt-8 print:mt-0"
    >
      <div class="header text-center mb-8">
        <h3 class="text-xl font-bold text-blue-800">
          ENGLISH GRAMMAR TEST
        </h3>
        <p class="mb-2">
          <strong>Time:</strong> 60 minutes | <strong>Full name:</strong>
          <input
            type="text"
            class="border-b border-gray-400 outline-none px-2 print:hidden"
            style="width: 220px"
          />
        </p>
      </div>
      <form id="grammarTest">
        <!-- Part 1: Multiple Choice -->
        <div class="section mb-8">
          <div class="section-title font-semibold mb-3">
            Part 1: Multiple Choice (2 marks)
          </div>
          <p class="mb-4">Choose the best answer:</p>
          <div class="space-y-2" id="mcq-container">
            <!-- Questions will be inserted here by JavaScript -->
          </div>
        </div>
        <!-- Part 2: Error Correction -->
        <div class="section mb-8">
          <div class="section-title font-semibold mb-3">
            Part 2: Error Correction (2 marks)
          </div>
          <p class="mb-4">
            Find the errors and rewrite the sentences correctly:
          </p>
          <div class="space-y-4" id="error-correction-container">
            <!-- Questions will be inserted here by JavaScript -->
          </div>
        </div>
        <!-- Part 3: Word Completion (Present Simple/Comparative/Like/Dislike) -->
        <div class="section mb-8">
          <div class="section-title font-semibold mb-3">
            Part 3: Word Completion (4 marks)
          </div>
          <p class="mb-4">
            Complete the sentences with the correct form of the verb:
          </p>
          <div class="space-y-4" id="verb-conjugation-container">
            <!-- Questions will be inserted here by JavaScript -->
          </div>
        </div>
        <!-- Part 4: Comparative Transformation -->
        <div class="section mb-8">
          <div class="section-title font-semibold mb-3">
            Part 4: Comparative Transformation (2 marks)
          </div>
          <p class="mb-4">
            Rewrite each sentence using the word(s) in brackets so that the meaning stays the same. Use the correct comparative form.
          </p>
          <div class="space-y-4" id="comparative-transformation-container">
            <!-- Questions will be inserted here by JavaScript -->
          </div>
        </div>
        <div class="flex justify-center mt-8 print:hidden">
          <button
            type="button"
            onclick="gradeTest()"
            class="bg-blue-600 text-white px-6 py-2 rounded shadow hover:bg-blue-700 font-semibold"
          >
            Submit
          </button>
        </div>
        <div
          id="result"
          class="mt-8 text-center text-lg font-bold print:hidden"
          style="display: none"
        ></div>
      </form>
    </div>
    <script>
      // Multiple Choice Questions (20 questions, 4 points)
      const mcqQuestions = [
        // 1. Present Simple - to be
        {
          question: "My uncle ___ a doctor at the city hospital.",
          options: ["A. am", "B. is", "C. are", "D. be"],
          answer: "B",
        },
        // 2. Present Simple - to be
        {
          question: "The children ___ excited about the trip.",
          options: ["A. is", "B. am", "C. are", "D. be"],
          answer: "C",
        },
        // 3. Present Simple - to be (negative)
        {
          question: "We ___ not ready for the test.",
          options: ["A. am", "B. is", "C. are", "D. be"],
          answer: "C",
        },
        // 4. Present Simple - to be (question)
        {
          question: "___ your parents at home now?",
          options: ["A. Is", "B. Are", "C. Am", "D. Be"],
          answer: "B",
        },
        // 5. Present Simple - verb (s/es)
        {
          question: "My sister ___ to music every evening.",
          options: ["A. listen", "B. listens", "C. listening", "D. listened"],
          answer: "B",
        },
        // 6. Present Simple - verb (s/es)
        {
          question: "We ___ our homework after dinner.",
          options: ["A. does", "B. do", "C. doing", "D. did"],
          answer: "B",
        },
        // 7. Present Simple - verb (s/es, negative)
        {
          question: "He ___ like spicy food.",
          options: ["A. don't", "B. doesn't", "C. isn't", "D. aren't"],
          answer: "B",
        },
        // 8. Present Simple - verb (s/es, question)
        {
          question: "___ your brother play tennis?",
          options: ["A. Do", "B. Does", "C. Is", "D. Are"],
          answer: "B",
        },
        // 9. Modal verbs
        {
          question: "You ___ park your car here. It's not allowed.",
          options: ["A. can", "B. must", "C. mustn't", "D. will"],
          answer: "C",
        },
        // 10. Modal verbs
        {
          question: "___ I borrow your pen, please?",
          options: ["A. Must", "B. Should", "C. Can", "D. Will"],
          answer: "C",
        },
        // 11. Modal verbs
        {
          question: "Children ___ cross the street alone.",
          options: ["A. mustn't", "B. can", "C. should", "D. may"],
          answer: "A",
        },
        // 12. Modal verbs
        {
          question: "You ___ try this cake. It's delicious!",
          options: ["A. can", "B. should", "C. mustn't", "D. may"],
          answer: "B",
        },
        // 13. Likes/Dislikes
        {
          question: "Anna ___ swimming in the sea.",
          options: ["A. like", "B. likes", "C. liking", "D. liked"],
          answer: "B",
        },
        // 14. Likes/Dislikes
        {
          question: "My friends ___ playing video games together.",
          options: ["A. enjoys", "B. enjoy", "C. enjoying", "D. enjoyed"],
          answer: "B",
        },
        // 15. Likes/Dislikes
        {
          question: "He ___ eating vegetables.",
          options: ["A. hates", "B. hate", "C. hating", "D. hated"],
          answer: "A",
        },
        // 16. Likes/Dislikes
        {
          question: "I ___ to read books than watch TV.",
          options: ["A. prefer", "B. prefers", "C. preferring", "D. preferred"],
          answer: "A",
        },
        // 17. Comparative adjectives
        {
          question: "This exercise is ___ than the last one.",
          options: ["A. easy", "B. easier", "C. more easy", "D. easiest"],
          answer: "B",
        },
        // 18. Comparative adjectives
        {
          question: "A giraffe is ___ than a horse.",
          options: ["A. tall", "B. taller", "C. more tall", "D. tallest"],
          answer: "B",
        },
        // 19. Comparative adverbs
        {
          question: "My sister sings ___ than me.",
          options: ["A. well", "B. better", "C. more well", "D. best"],
          answer: "B",
        },
        // 20. Comparative adverbs
        {
          question: "He drives ___ than his brother.",
          options: ["A. carefully", "B. more carefully", "C. most carefully", "D. careful"],
          answer: "B",
        },
      ];

      // Error Correction Questions (10 questions)
      const errorCorrectionQuestions = [
        {
          question: "She go to school by bus every day.",
          answer: "She goes to school by bus every day."
        },
        {
          question: "We was at the cinema last night.",
          answer: "We were at the cinema last night."
        },
        {
          question: "Does he likes ice cream?",
          answer: "Does he like ice cream?"
        },
        {
          question: "My mother don't work on Sundays.",
          answer: "My mother doesn't work on Sundays."
        },
        {
          question: "You must to finish your homework.",
          answer: "You must finish your homework."
        },
        {
          question: "I can to speak three languages.",
          answer: "I can speak three languages."
        },
        {
          question: "She enjoy to play the piano.",
          answer: "She enjoys playing the piano."
        },
        {
          question: "He doesn't likes football.",
          answer: "He doesn't like football."
        },
        {
          question: "This book is more interesting that that one.",
          answer: "This book is more interesting than that one."
        },
        {
          question: "He drives more fast than me.",
          answer: "He drives faster than me."
        }
      ];

      // Word Completion Questions (20 questions, 4 points)
      const verbConjugationQuestions = [
        // Present Simple (affirmative, negative, question, various verbs)
        { question: "My cousin ___ (be) a university student.", answer: "is" },
        { question: "We ___ (not be) in the classroom now.", answer: "are not||aren't" },
        { question: "My mother ___ (cook) dinner every evening.", answer: "cooks" },
        { question: "___ (can) you play the guitar?", answer: "Can" },
        { question: "He ___ (not like) eating carrots.", answer: "does not like||doesn't like" },
        { question: "She ___ (prefer) orange juice to apple juice.", answer: "prefers" },
        { question: "They ___ (hate) doing homework.", answer: "hate" },
        // Use possessive adjectives/pronouns for comparison
        { question: "Her car is ___ (fast) than mine.", answer: "faster" },
        { question: "This movie is ___ (interesting) than the last one.", answer: "more interesting" },
        { question: "My brother speaks French ___ (well) than me.", answer: "better" },
        // More Present Simple (varied verbs)
        { question: "We ___ (study) at the library after school.", answer: "study" },
        { question: "My father ___ (not work) on Saturdays.", answer: "does not work||doesn't work" },
        { question: "___ (do) you like chocolate?", answer: "Do" },
        { question: "She ___ (watch) cartoons every morning.", answer: "watches" },
        { question: "They ___ (not have) any brothers or sisters.", answer: "do not have||don't have" },
        { question: "He ___ (read) the newspaper every day.", answer: "reads" },
        { question: "___ (does) your friend play football?", answer: "Does" },
        { question: "I ___ (enjoy) playing badminton.", answer: "enjoy" },
        { question: "We ___ (not go) to the park on Sunday.", answer: "do not go||don't go" },
        { question: "My grandparents ___ (love) gardening.", answer: "love" }
      ];

      // Comparative Transformation Questions (10 questions, 2 points)
      const comparativeTransformationQuestions = [
        {
          // easy -> more easy/easier, use possessive adjectives/pronouns
          question: "My test is more difficult than yours. (easy)",
          answer: "Your test is easier than mine.||Your test is more easy than mine."
        },
        {
          // more expensive -> cheaper
          question: "A train ticket is more expensive than a bus ticket. (cheap)",
          answer: "A bus ticket is cheaper than a train ticket."
        },
        {
          // runs faster -> use "slower" instead of "not as ... as"
          question: "She runs faster than me. (slow)",
          answer: "I run slower than she does.||I run more slowly than she does."
        },
        {
          // more interesting -> less boring, use possessive adjectives/pronouns
          question: "This film is more interesting than that one. (boring)",
          answer: "That film is more boring than this one.||That film is less interesting than this one."
        },
        {
          // better -> use "worse" instead of "not as ... as"
          question: "My sister draws better than me. (badly)",
          answer: "I draw worse than my sister.||I draw more badly than my sister."
        },
        {
          // more beautiful -> less beautiful, use possessive adjectives/pronouns
          question: "Her garden is more beautiful than mine. (less)",
          answer: "My garden is less beautiful than hers."
        },
        {
          // taller -> use "shorter" instead of "not as ... as"
          question: "The tree is taller than the house. (short)",
          answer: "The house is shorter than the tree."
        },
        {
          // colder -> use "warmer" instead of "not as ... as"
          question: "Winter is colder than autumn. (warm)",
          answer: "Autumn is warmer than winter."
        },
        {
          // more expensive -> cheaper, use possessive adjectives/pronouns
          question: "My shoes are more expensive than yours. (cheap)",
          answer: "Your shoes are cheaper than mine."
        },
        {
          // more difficult -> easier, use possessive adjectives/pronouns
          question: "English is more difficult than Math. (easy)",
          answer: "Math is easier than English.||Math is more easy than English."
        }
      ];

      // Function to shuffle array
      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      // Display MCQ Questions
      function displayMcqQuestions() {
        const container = document.getElementById("mcq-container");
        const shuffledQuestions = shuffleArray([...mcqQuestions]);
        shuffledQuestions.forEach((q, index) => {
          const questionDiv = document.createElement("div");
          questionDiv.className = "question";
          const label = document.createElement("label");
          label.textContent = `${index + 1}. ${q.question}`;
          questionDiv.appendChild(label);
          const optionsDiv = document.createElement("div");
          optionsDiv.className = "grid grid-cols-4 gap-x-8";
          const correctAnswerText = q.options
            .find((opt) => opt.startsWith(q.answer + "."))
            .substring(3);
          const optionTexts = q.options.map((opt) => opt.substring(3));
          const shuffledOptionTexts = shuffleArray([...optionTexts]);
          const newCorrectAnswerLetter = String.fromCharCode(
            65 + shuffledOptionTexts.indexOf(correctAnswerText)
          );
          questionDiv.setAttribute("data-answer", newCorrectAnswerLetter);
          const letters = ["A", "B", "C", "D"];
          shuffledOptionTexts.forEach((text, i) => {
            const optionLabel = document.createElement("label");
            optionLabel.className = "block";
            const radio = document.createElement("input");
            radio.type = "radio";
            radio.name = `mcq${index + 1}`;
            radio.value = letters[i];
            radio.className = "mr-2";
            optionLabel.appendChild(radio);
            optionLabel.appendChild(
              document.createTextNode(`${letters[i]}. ${text}`)
            );
            optionsDiv.appendChild(optionLabel);
          });
          questionDiv.appendChild(optionsDiv);
          container.appendChild(questionDiv);
        });
      }

      // Display Error Correction Questions
      function displayErrorCorrectionQuestions() {
        const container = document.getElementById("error-correction-container");
        const shuffledQuestions = shuffleArray([...errorCorrectionQuestions]);
        shuffledQuestions.forEach((q, index) => {
          const questionDiv = document.createElement("div");
          questionDiv.className = "question";
          questionDiv.setAttribute("data-answer", q.answer);
          const label = document.createElement("label");
          label.innerHTML = `${index + 1}. ${q.question}<br>`;
          const input = document.createElement("input");
          input.name = `err${index + 1}`;
          input.className = "border-b border-gray-300 w-full mt-1 p-1";
          input.rows = 1;
          label.appendChild(input);
          questionDiv.appendChild(label);
          container.appendChild(questionDiv);
        });
      }

      // Display Verb Conjugation (Word Completion) Questions
      function displayVerbConjugationQuestions() {
        const container = document.getElementById("verb-conjugation-container");
        const shuffledQuestions = shuffleArray([...verbConjugationQuestions]);
        shuffledQuestions.forEach((q, index) => {
          const questionDiv = document.createElement("div");
          questionDiv.className = "question";
          questionDiv.setAttribute("data-answer", q.answer);
          const label = document.createElement("label");
          const questionText = q.question.replace(
            "___",
            `<input type="text" name="verb${
              index + 1
            }" class="border-b border-gray-400 w-32 px-1">`
          );
          label.innerHTML = `${index + 1}. ${questionText}`;
          questionDiv.appendChild(label);
          container.appendChild(questionDiv);
        });
      }

      // Display Comparative Transformation Questions
      function displayComparativeTransformationQuestions() {
        const container = document.getElementById("comparative-transformation-container");
        const shuffledQuestions = shuffleArray([...comparativeTransformationQuestions]);
        shuffledQuestions.forEach((q, index) => {
          const questionDiv = document.createElement("div");
          questionDiv.className = "question";
          questionDiv.setAttribute("data-answer", q.answer);
          const label = document.createElement("label");
          label.innerHTML = `${index + 1}. ${q.question}<br>`;
          const input = document.createElement("input");
          input.name = `cmp${index + 1}`;
          input.className = "border-b border-gray-300 w-full mt-1 p-1";
          input.rows = 1;
          label.appendChild(input);
          questionDiv.appendChild(label);
          container.appendChild(questionDiv);
        });
      }

      // Initialize when page loads
      window.onload = function () {
        displayMcqQuestions();
        displayErrorCorrectionQuestions();
        displayVerbConjugationQuestions();
        displayComparativeTransformationQuestions();
      };

      function getAnswersFromAttr(questionElem) {
        return (questionElem.getAttribute("data-answer") || "")
          .split("||")
          .map((s) => s.trim());
      }

      function gradeTest() {
        let score = 0;
        let form = document.forms["grammarTest"];
        document.querySelectorAll(".question").forEach((q) => {
          q.querySelectorAll(
            "input[type=radio], input[type=text], input"
          ).forEach((input) => {
            input.classList.remove(
              "bg-green-100",
              "border-green-500",
              "bg-red-100",
              "border-red-500",
              "border-2"
            );
            if (input.type === "radio")
              input.parentElement.classList.remove(
                "bg-green-100",
                "border-green-500",
                "bg-red-100",
                "border-red-500",
                "border-2"
              );
          });
        });

        // Grade MCQs (4 points)
        for (let i = 1; i <= mcqQuestions.length; i++) {
          let qElem = document
            .querySelector(`.question input[name=mcq${i}]`)
            .closest(".question");
          let correct = getAnswersFromAttr(qElem)[0];
          let radioList = form.querySelectorAll(`input[name=mcq${i}]`);
          radioList.forEach((radio) => {
            if (radio.checked) {
              if (radio.value === correct) {
                radio.parentElement.classList.add(
                  "bg-green-100",
                  "border-green-500",
                  "border-2"
                );
                score += 0.2;
              } else {
                radio.parentElement.classList.add(
                  "bg-red-100",
                  "border-red-500",
                  "border-2"
                );
              }
            }
          });
        }

        // Grade Error Correction (2 points)
        for (let i = 1; i <= errorCorrectionQuestions.length; i++) {
          let qElem = document
            .querySelector(`input[name=err${i}]`)
            .closest(".question");
          let corrects = getAnswersFromAttr(qElem).map((ans) =>
            ans
              .toLowerCase()
              .replace(/[.\s]+/g, " ")
              .trim()
          );
          let val = form[`err${i}`].value
            .trim()
            .toLowerCase()
            .replace(/[.\s]+/g, " ")
            .trim();
          if (corrects.includes(val)) {
            form[`err${i}`].classList.add(
              "bg-green-100",
              "border-green-500",
              "border-2"
            );
            score += 0.4;
          } else {
            form[`err${i}`].classList.add(
              "bg-red-100",
              "border-red-500",
              "border-2"
            );
          }
        }

        // Grade Verb Conjugation (4 points, 20 questions)
        for (let i = 1; i <= verbConjugationQuestions.length; i++) {
          let input = form[`verb${i}`];
          let qElem = input.closest(".question");
          let corrects = getAnswersFromAttr(qElem).map((ans) =>
            ans.toLowerCase()
          );
          let val = input.value.trim().toLowerCase();
          if (corrects.includes(val)) {
            input.classList.add("bg-green-100", "border-green-500", "border-2");
            score += 0.2;
          } else {
            input.classList.add("bg-red-100", "border-red-500", "border-2");
          }
        }

        // Grade Comparative Transformation (2 points, 10 questions)
        for (let i = 1; i <= comparativeTransformationQuestions.length; i++) {
          let input = form[`cmp${i}`];
          let qElem = input.closest(".question");
          let corrects = getAnswersFromAttr(qElem).map((ans) =>
            ans
              .toLowerCase()
              .replace(/[?.\s]+/g, " ")
              .trim()
          );
          let val = input.value
            .trim()
            .toLowerCase()
            .replace(/[?.\s]+/g, " ")
            .trim();
          if (corrects.some((ans) => val === ans)) {
            input.classList.add("bg-green-100", "border-green-500", "border-2");
            score += 0.2;
          } else {
            input.classList.add("bg-red-100", "border-red-500", "border-2");
          }
        }

        document.getElementById("result").style.display = "";
        document.getElementById(
          "result"
        ).innerHTML = `Điểm của bạn: <span class="text-blue-700">${score.toFixed(
          1
        )} / 10</span>`;
      }
    </script>
  </body>
</html>
