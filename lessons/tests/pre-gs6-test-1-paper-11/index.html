<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRE GRADE 6 - ENGLISH GRAMMAR TEST 1 – (PAPER 11)</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background: #fff;
            color: #222;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 700px;
            margin: 30px auto;
            background: #fff;
            padding: 32px 32px 24px 32px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.07);
        }
        .main-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-align: center;
            color: #1743b3;
        }
        .info {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .info strong {
            font-weight: bold;
        }
        .section-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-top: 2rem;
            margin-bottom: 0.5rem;
        }
        .section-title .vi {
            font-weight: bold;
        }
        .section-title .en {
            font-style: italic;
            font-weight: normal;
        }
        .section-desc {
            font-style: italic;
            margin-bottom: 1rem;
        }
        .question {
            margin-bottom: 1.2rem;
        }
        .question strong {
            font-weight: bold;
        }
        .answers {
            margin-left: 2.2em;
            margin-top: 0.3em;
        }
        .answers label {
            display: block;
            margin-bottom: 0.2em;
            cursor: pointer;
            font-weight: normal;
        }
        .answers input[type="radio"] {
            margin-right: 8px;
        }
        .blank, .cloze-input {
            border: none;
            border-bottom: 1px solid #888;
            min-width: 60px;
            display: inline-block;
            text-align: center;
            font-size: 1em;
            margin: 0 2px;
            background: #fff;
        }
        .error-input {
            border: none;
            border-bottom: 1px solid #888;
            font-size: 1em;
            width: 75%;
            padding: 2px 4px;
            text-align: left;
            background: #fff;
            margin-left: 5px;
        }
        .student-name {
            border: none;
            border-bottom: 1px solid #222;
            min-width: 200px;
            font-size: 1em;
            background: #fff;
        }
        .error-correct {
            margin-left: 2.2em;
            margin-top: 0.3em;
        }
        .submit-btn {
            font-size:1.1em;
            padding: 0.6em 2em;
            background:#1743b3;
            color:#fff;
            border:none;
            border-radius:5px;
            cursor:pointer;
            margin-top:2.5rem;
            display: inline-block;
        }
        .submit-wrap {
            text-align:center;
        }
        .error-question {
            margin-bottom: 1.6rem;
        }
        .cloze-paragraph {
            line-height: 1.8;
        }
        .correct-line {
            margin-top: 0.5rem; /* Increased spacing */
        }
        .explanation-text {
            display: block;
            color: #d94d00;
            font-style: italic;
            font-size: 0.9em;
            margin-top: 0.4em;
        }
        @media (max-width: 600px) {
            .container {
                max-width: 100vw !important;
                margin: 0 !important;
                padding: 0 14px !important;
                border-radius: 0 !important;
                box-shadow: none !important;
            }
            .main-title {
                font-size: 1rem !important;
                text-align: center !important;
                margin-bottom: 1em !important;
                color: #1743b3 !important;
                font-weight: bold !important;
            }
            .info, .section-title, .section-desc {
                font-size: 0.95rem !important;
                text-align: center !important;
            }
            .section-title {
                margin-top: 1.2em !important;
                margin-bottom: 0.5em !important;
                font-weight: bold !important;
            }
            .section-desc {
                margin-bottom: 1em !important;
            }
            .question {
                font-size: 0.93rem !important;
                margin-bottom: 0.8rem !important;
                padding-left: 0.1em !important;
                padding-right: 0.1em !important;
            }
            .answers {
                margin-left: 0 !important;
                margin-top: 0.2em !important;
            }
            .answers label {
                display: flex !important;
                align-items: center !important;
                font-size: 0.93rem !important;
                margin-bottom: 0.3em !important;
                padding: 0.15em 0 0.15em 0.1em !important;
                border-radius: 0 !important;
                background: none !important;
                font-weight: normal !important;
                cursor: pointer !important;
                border: none !important;
                width: 100% !important;
                box-sizing: border-box !important;
            }
            .answers input[type="radio"] {
                width: 1em !important;
                height: 1em !important;
                accent-color: #1743b3 !important;
                margin-right: 8px !important;
                flex-shrink: 0 !important;
            }
            .blank, .cloze-input, .error-input, .student-name {
                min-width: 40px !important;
                font-size: 0.93em !important;
                width: 90% !important;
                box-sizing: border-box !important;
                margin-bottom: 5px !important;
                border-radius: 3px !important;
            }
            .submit-btn {
                font-size: 0.98em !important;
                padding: 0.7em 1.2em !important;
                width: 100% !important;
                margin-top: 1em !important;
                border-radius: 5px !important;
                background: #1743b3 !important;
                color: #fff !important;
                font-weight: bold !important;
                border: none !important;
                letter-spacing: 0.5px !important;
                display: block !important;
            }
            .submit-btn:hover, .submit-btn:focus {
                background: #0d2e7a !important;
            }
            .submit-wrap {
                padding: 0 !important;
            }
            #score-modal-content {
                width: 98vw !important;
                max-width: 99vw !important;
                padding: 1em 0.2em 1em 0.2em !important;
                font-size: 0.98em !important;
            }
            #score-modal-score {
                font-size: 1.2em !important;
            }
            #score-modal-message {
                font-size: 0.95em !important;
            }
        }
        #score-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.35);
            align-items: center;
            justify-content: center;
        }
        #score-modal-content {
            background: #fff;
            padding: 2em 1.5em 1.5em 1.5em;
            border-radius: 16px;
            max-width: 90vw;
            width: 350px;
            box-shadow: 0 4px 32px rgba(0,0,0,0.18);
            text-align: center;
            position: relative;
        }
        #score-modal-close {
            position: absolute;
            top: 10px;
            right: 18px;
            font-size: 1.5em;
            cursor: pointer;
        }
        #score-modal-message {
            font-size: 1.15em;
            margin-bottom: 1.2em;
        }
        #score-modal-score {
            font-size: 2.2em;
            font-weight: bold;
            color: #d94d00;
            margin-bottom: 0.7em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-title">PRE GRADE 6 - ENGLISH GRAMMAR TEST 1 – (PAPER 11)</div>
        <div class="info">
            <strong>Time:</strong> 45 minutes | <strong>Full name:</strong> <input class="student-name" type="text" placeholder="">
        </div>

        <!-- Part 1: Multiple Choice -->
        <div class="section-title"><span class="vi">Phần 1: Trắc nghiệm (2 điểm)</span> - <span class="en">Multiple Choice (2 marks)</span></div>
        <div class="section-desc"><em>Chọn đáp án đúng nhất</em> (<span>Choose the best answer</span>):</div>
        <div class="question">
            1. Which of the following is <strong>uncountable</strong>?
            <div class="answers">
                <label><input type="radio" name="q1" value="A">A. chocolate</label>
                <label><input type="radio" name="q1" value="B">B. pen</label>
                <label><input type="radio" name="q1" value="C">C. apple</label>
                <label><input type="radio" name="q1" value="D">D. chair</label>
            </div>
        </div>
        <div class="question">
            2. Choose the correct plural of <strong>"foot"</strong>:
            <div class="answers">
                <label><input type="radio" name="q2" value="A">A. foots</label>
                <label><input type="radio" name="q2" value="B">B. footes</label>
                <label><input type="radio" name="q2" value="C">C. feet</label>
                <label><input type="radio" name="q2" value="D">D. feets</label>
            </div>
        </div>
        <div class="question">
            3. Which noun is <strong>countable</strong>?
            <div class="answers">
                <label><input type="radio" name="q3" value="A">A. sugar</label>
                <label><input type="radio" name="q3" value="B">B. bread</label>
                <label><input type="radio" name="q3" value="C">C. juice</label>
                <label><input type="radio" name="q3" value="D">D. pencil</label>
            </div>
        </div>
        <div class="question">
            4. I saw ___ elephant at the zoo.
            <div class="answers">
                <label><input type="radio" name="q4" value="A">A. a</label>
                <label><input type="radio" name="q4" value="B">B. an</label>
                <label><input type="radio" name="q4" value="C">C. the</label>
                <label><input type="radio" name="q4" value="D">D. Ø</label>
            </div>
        </div>
        <div class="question">
            5. Could I have ___ water, please?
            <div class="answers">
                <label><input type="radio" name="q5" value="A">A. an</label>
                <label><input type="radio" name="q5" value="B">B. a</label>
                <label><input type="radio" name="q5" value="C">C. some</label>
                <label><input type="radio" name="q5" value="D">D. the</label>
            </div>
        </div>
        <div class="question">
            6. We do not have ___ apples left.
            <div class="answers">
                <label><input type="radio" name="q6" value="A">A. some</label>
                <label><input type="radio" name="q6" value="B">B. any</label>
                <label><input type="radio" name="q6" value="C">C. an</label>
                <label><input type="radio" name="q6" value="D">D. many</label>
            </div>
        </div>
        <div class="question">
            7. Which pronoun replaces <strong>"John and Mary"</strong> as subject?
            <div class="answers">
                <label><input type="radio" name="q7" value="A">A. them</label>
                <label><input type="radio" name="q7" value="B">B. we</label>
                <label><input type="radio" name="q7" value="C">C. they</label>
                <label><input type="radio" name="q7" value="D">D. us</label>
            </div>
        </div>
        <div class="question">
            8. My friend invited me and gave the ticket to ___ .
            <div class="answers">
                <label><input type="radio" name="q8" value="A">A. I</label>
                <label><input type="radio" name="q8" value="B">B. me</label>
                <label><input type="radio" name="q8" value="C">C. mine</label>
                <label><input type="radio" name="q8" value="D">D. my</label>
            </div>
        </div>
        <div class="question">
            9. The plural of <strong>"woman"</strong> is:
            <div class="answers">
                <label><input type="radio" name="q9" value="A">A. womans</label>
                <label><input type="radio" name="q9" value="B">B. women</label>
                <label><input type="radio" name="q9" value="C">C. womanses</label>
                <label><input type="radio" name="q9" value="D">D. woman</label>
            </div>
        </div>
        <div class="question">
            10. Which sentence is correct?
            <div class="answers">
                <label><input type="radio" name="q10" value="A">A. He eats an banana every day.</label>
                <label><input type="radio" name="q10" value="B">B. I bought some milk and a cookies.</label>
                <label><input type="radio" name="q10" value="C">C. She has a new pencil case.</label>
                <label><input type="radio" name="q10" value="D">D. We have any books at home.</label>
            </div>
        </div>

        <!-- Part 2: Fill in the blanks -->
        <div class="section-title"><span class="vi">Phần 2: Điền từ (2 điểm)</span> - <span class="en">Fill in the blanks (2 marks)</span></div>
        <div class="section-desc"><em>Điền từ thích hợp vào chỗ trống</em> (<span>Fill in the blanks with appropriate words</span>):</div>
        <div class="question">1. I saw two <input class="blank" type="text" name="f1" autocomplete="off" placeholder=""> (mouse/mice) near the bin.</div>
        <div class="question">2. Do you have <input class="blank" type="text" name="f2" autocomplete="off" placeholder=""> (some/any) sugar?</div>
        <div class="question">3. They gave <input class="blank" type="text" name="f3" autocomplete="off" placeholder=""> (he/him) a present.</div>
        <div class="question">4. That is <input class="blank" type="text" name="f4" autocomplete="off" placeholder=""> (a/an/some) unusual painting.</div>
        <div class="question">5. <input class="blank" type="text" name="f5" autocomplete="off" placeholder=""> (She/Her) and I are best friends.</div>
        <div class="question">6. Please give this to <input class="blank" type="text" name="f6" autocomplete="off" placeholder=""> (they/them).</div>
        <div class="question">7. I want <input class="blank" type="text" name="f7" autocomplete="off" placeholder=""> (a/an/some) lemonade.</div>
        <div class="question">8. There is not <input class="blank" type="text" name="f8" autocomplete="off" placeholder=""> (some/any) cereal left.</div>
        <div class="question">9. We ate <input class="blank" type="text" name="f9" autocomplete="off" placeholder=""> (a/an/the/Ø) apple after lunch.</div>
        <div class="question">10. My uncle gave <input class="blank" type="text" name="f10" autocomplete="off" placeholder=""> (I/me) a storybook.</div>

        <!-- Part 3: Error Correction -->
        <div class="section-title"><span class="vi">Phần 3: Tìm lỗi sai (3 điểm)</span> - <span class="en">Error Correction (3 marks)</span></div>
        <div class="section-desc"><em>Tìm lỗi sai và viết lại câu đúng</em> (<span>Find the error and rewrite the sentence correctly</span>):</div>
        <div class="question error-question">
            1. I would like an water, please.<br>
            Correct: <input class="error-input" type="text" name="e1" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            2. Me and my sister went to school.<br>
            Correct: <input class="error-input" type="text" name="e2" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            3. There are any pencils in my bag.<br>
            Correct: <input class="error-input" type="text" name="e3" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            4. She bought a apples at the store.<br>
            Correct: <input class="error-input" type="text" name="e4" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            5. We did not have some time to finish.<br>
            Correct: <input class="error-input" type="text" name="e5" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            6. I gave she a small present.<br>
            Correct: <input class="error-input" type="text" name="e6" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            7. The Physics is my favourite subject.<br>
            Correct: <input class="error-input" type="text" name="e7" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            8. Him plays soccer every weekend.<br>
            Correct: <input class="error-input" type="text" name="e8" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            9. There are 40 quizzs on our English test.<br>
            Correct: <input class="error-input" type="text" name="e9" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            10. They saw four foots under the table.<br>
            Correct: <input class="error-input" type="text" name="e10" autocomplete="off" placeholder="">
        </div>

        <!-- Part 4: Cloze Test -->
        <div class="section-title"><span class="vi">Phần 4: Điền từ vào đoạn văn (3 điểm)</span> - <span class="en">Cloze Test (3 marks)</span></div>
        <div class="section-desc"><em>Điền từ thích hợp vào chỗ trống trong đoạn văn sau</em> (<span>Fill in the blanks with appropriate words</span>):</div>
        <div class="question cloze-paragraph">
            <strong>A.</strong> This afternoon, I met my cousin at <input class="cloze-input" type="text" name="c1" autocomplete="off" placeholder=""> (1) library. He gave me <input class="cloze-input" type="text" name="c2" autocomplete="off" placeholder=""> (2) book and showed me how to borrow <input class="cloze-input" type="text" name="c3" autocomplete="off" placeholder=""> (3) others. We sat together and read for an hour. I thanked <input class="cloze-input" type="text" name="c4" autocomplete="off" placeholder=""> (4) before going home. He always helps <input class="cloze-input" type="text" name="c5" autocomplete="off" placeholder=""> (5) when I need it.
        </div>
        <div class="question cloze-paragraph">
            <strong>B.</strong> In the kitchen, I looked for <input class="cloze-input" type="text" name="c6" autocomplete="off" placeholder=""> (1) eggs but there were not <input class="cloze-input" type="text" name="c7" autocomplete="off" placeholder=""> (2) left. I asked Mom, and she gave <input class="cloze-input" type="text" name="c8" autocomplete="off" placeholder=""> (3) some snacks instead. She also brought <input class="cloze-input" type="text" name="c9" autocomplete="off" placeholder=""> (4) carton of milk and made sandwiches for <input class="cloze-input" type="text" name="c10" autocomplete="off" placeholder=""> (5).
        </div>

        <div class="submit-wrap">
            <button class="submit-btn">Nộp bài / Submit</button>
            <div id="score-result" style="margin-top:1.5em;font-size:1.1em;font-weight:bold;color:#1743b3;"></div>
        </div>
    </div>
    <div id="score-modal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);align-items:center;justify-content:center;">
        <div id="score-modal-content" style="background:#fff;padding:2em 1.5em 1.5em 1.5em;border-radius:16px;max-width:90vw;width:350px;box-shadow:0 4px 32px rgba(0,0,0,0.18);text-align:center;position:relative;">
            <span id="score-modal-close" style="position:absolute;top:10px;right:18px;font-size:1.5em;cursor:pointer;">&times;</span>
            <div id="score-modal-message" style="font-size:1.15em;margin-bottom:1.2em;"></div>
            <div id="score-modal-score" style="font-size:2.2em;font-weight:bold;color:#d94d00;margin-bottom:0.7em;"></div>
        </div>
    </div>
    <script>
    const answers = {
        // Part 1
        q1: 'A', // chocolate is uncountable
        q2: 'C', // feet is the plural of foot
        q3: 'D', // pencil is countable
        q4: 'B', // an elephant
        q5: 'C', // some water
        q6: 'B', // any apples
        q7: 'C', // they replaces "John and Mary" as subject (personal pronoun, subject form)
        q8: 'B', // me (object pronoun)
        q9: 'B', // women is the plural of woman
        q10: 'C', // She has a new pencil case (correct sentence)
        // Part 2
        f1: 'mice',
        f2: 'any',
        f3: 'him',
        f4: 'an',
        f5: 'She',
        f6: 'them',
        f7: 'some',
        f8: 'any',
        f9: 'an',
        f10: 'me',
        // Part 3
        e1: 'I would like some water, please.',
        e2: 'My sister and I went to school.',
        e3: 'There are some pencils in my bag.',
        e4: 'She bought apples at the store.',
        e5: 'We did not have any time to finish.',
        e6: 'I gave her a small present.',
        e7: 'Physics is my favourite subject.',
        e8: 'He plays soccer every weekend.',
        e9: 'There are 40 quizzes on our English test.',
        e10: 'They saw four feet under the table.',
        // Part 4
        c1: 'the', c2: 'a', c3: 'the', c4: 'him', c5: 'me',
        c6: 'any', c7: 'any', c8: 'me', c9: 'a', c10: 'us'
    };

    const explanations = {
        // Part 1
        q1: "Đáp án đúng là: chocolate. 'Chocolate' là danh từ không đếm được (uncountable noun), còn 'pen', 'apple', 'chair' đều là danh từ đếm được.",
        q2: "Đáp án đúng là: feet. Số nhiều của 'foot' là 'feet' (bất quy tắc), các đáp án khác sai quy tắc.",
        q3: "Đáp án đúng là: pencil. 'Pencil' là danh từ đếm được (countable noun), còn 'sugar', 'bread', 'juice' thường không đếm được.",
        q4: "Đáp án đúng là: an. 'Elephant' bắt đầu bằng nguyên âm nên dùng 'an'.",
        q5: "Đáp án đúng là: some. 'Water' là danh từ không đếm được, dùng 'some' để xin một lượng không xác định.",
        q6: "Đáp án đúng là: any. Dùng 'any' trong câu phủ định (not have any apples).",
        q7: "Đáp án đúng là: they. Đại từ nhân xưng chủ ngữ (personal pronoun, subject form) thay thế cho 'John and Mary' là 'they'. 'Them' là tân ngữ, 'we' là chúng tôi, 'us' là tân ngữ.",
        q8: "Đáp án đúng là: me. Đại từ nhân xưng tân ngữ (object pronoun) dùng sau giới từ hoặc động từ, thay thế cho 'I' khi là tân ngữ.",
        q9: "Đáp án đúng là: women. Số nhiều bất quy tắc của 'woman' là 'women'.",
        q10: "Đáp án đúng là: She has a new pencil case. Câu này đúng ngữ pháp và nghĩa. Các câu khác sai về mạo từ hoặc danh từ số nhiều/số ít.",
        // Part 2
        f1: "Đáp án đúng là: mice. Số nhiều của 'mouse' là 'mice'.",
        f2: "Đáp án đúng là: any. Dùng 'any' trong câu hỏi phủ định hoặc nghi vấn.",
        f3: "Đáp án đúng là: him. 'Him' là đại từ tân ngữ (object pronoun) dùng sau động từ 'gave'. Vì đã xác định rõ giới tính là nam nên chỉ dùng 'him' là đúng.",
        f4: "Đáp án đúng là: an. 'Unusual' bắt đầu bằng nguyên âm nên dùng 'an'.",
        f5: "Đáp án đúng là: She. 'She' là đại từ chủ ngữ (subject pronoun) đứng đầu câu.",
        f6: "Đáp án đúng là: them. 'Them' là đại từ tân ngữ (object pronoun) dùng sau giới từ 'to'. Nếu đã xác định rõ là nhóm người, dùng 'them' là đúng.",
        f7: "Đáp án đúng là: some. 'Lemonade' là danh từ không đếm được, dùng 'some' để xin một lượng không xác định.",
        f8: "Đáp án đúng là: any. Dùng 'any' trong câu phủ định (not any cereal left).",
        f9: "Đáp án đúng là: an. 'Apple' bắt đầu bằng nguyên âm nên dùng 'an'.",
        f10: "Đáp án đúng là: me. 'Me' là đại từ tân ngữ (object pronoun) dùng sau động từ 'gave'. Vì đã xác định rõ người nhận là mình nên chỉ dùng 'me' là đúng.",
        // Part 3
        e1: "Đáp án đúng là: I would like some water, please. 'Water' là danh từ không đếm được, không dùng 'an'.",
        e2: "Đáp án đúng là: My sister and I went to school. Chủ ngữ phải là 'My sister and I'.",
        e3: "Đáp án đúng là: There are some pencils in my bag. Dùng 'some' trong câu khẳng định.",
        e4: "Đáp án đúng là: She bought apples at the store. Không dùng 'a' trước danh từ số nhiều.",
        e5: "Đáp án đúng là: We did not have any time to finish. Dùng 'any' trong câu phủ định.",
        e6: "Đáp án đúng là: I gave her a small present. 'Her' là đại từ tân ngữ (object pronoun) dùng sau động từ 'gave'. Vì đã xác định rõ giới tính là nữ nên chỉ dùng 'her' là đúng.",
        e7: "Đáp án đúng là: Physics is my favourite subject. Không dùng 'The' trước tên môn học.",
        e8: "Đáp án đúng là: He plays soccer every weekend. 'He' là đại từ chủ ngữ (subject pronoun).",
        e9: "Đáp án đúng là: There are 40 quizzes on our English test. Số nhiều của 'quiz' là 'quizzes'.",
        e10: "Đáp án đúng là: They saw four feet under the table. Số nhiều của 'foot' là 'feet'.",
        // Part 4
        c1: "Đáp án đúng là: the. (1) Gặp ở thư viện xác định nên dùng 'the'.",
        c2: "Đáp án đúng là: a. (2) Một quyển sách bất kỳ nên dùng 'a'.",
        c3: "Đáp án đúng là: the. (3) Những quyển khác đã xác định nên dùng 'the'.",
        c4: "Đáp án đúng là: him. (4) Tân ngữ chỉ người được cảm ơn. Vì đã xác định rõ giới tính là nam nên chỉ dùng 'him' là đúng.",
        c5: "Đáp án đúng là: me. (5) Đại từ tân ngữ chỉ bản thân mình.",
        c6: "Đáp án đúng là: any. (1) Tìm trứng nhưng không còn nên dùng 'any'.",
        c7: "Đáp án đúng là: any. (2) Không còn chút nào nên dùng 'any'.",
        c8: "Đáp án đúng là: me. (3) Mẹ cho tôi đồ ăn vặt nên dùng 'me'. Vì đã xác định rõ người nhận là mình nên chỉ dùng 'me' là đúng.",
        c9: "Đáp án đúng là: a. (4) Một hộp sữa nên dùng 'a'.",
        c10: "Đáp án đúng là: us. (5) Làm bánh sandwich cho chúng tôi nên dùng 'us'. Nếu đã xác định rõ là nhóm người, dùng 'us' là đúng."
    };

    document.querySelector('.submit-btn').addEventListener('click', function(e) {
        e.preventDefault();
        // Clear previous results and explanations
        document.querySelectorAll('.answers label').forEach(lab => {
            lab.style.color = ''; lab.style.fontWeight = '';
        });
        document.querySelectorAll('.blank, .cloze-input, .error-input').forEach(inp => {
            inp.style.background = ''; inp.style.color = '';
        });
        document.querySelectorAll('.explanation-text').forEach(el => el.remove());
        document.getElementById('score-result').textContent = '';

        let part1Correct = 0, part2Correct = 0, part3Correct = 0, part4Correct = 0;

        const showExplanation = (key, element) => {
            if (explanations[key]) {
                const exp = document.createElement('span');
                exp.className = 'explanation-text';
                exp.textContent = explanations[key];
                element.parentNode.appendChild(exp);
            }
        };

        // Check Part 1: Multiple Choice
        for (let i = 1; i <= 10; i++) {
            const qName = 'q' + i;
            const correct = answers[qName];
            const checked = document.querySelector(`input[name="${qName}"]:checked`);
            if (checked) {
                if (checked.value.toLowerCase() === correct.toLowerCase()) {
                    checked.parentElement.style.color = 'green';
                    checked.parentElement.style.fontWeight = 'bold';
                    part1Correct++;
                } else {
                    checked.parentElement.style.color = 'red';
                    checked.parentElement.style.fontWeight = 'bold';
                    showExplanation(qName, checked.parentElement);
                }
            }
        }

        // Check Part 2, 3, 4: Inputs
        Object.keys(answers).forEach(key => {
            if (key.startsWith('f') || key.startsWith('e') || key.startsWith('c')) {
                const inp = document.querySelector(`[name="${key}"]`);
                if (!inp) return;
                let userVal = inp.value.trim().replace(/\s+/g, ' ');
                let correctVal = answers[key];
                let isCorrect = false;
                if (key.startsWith('e')) {
                    const normalize = str => {
                        str = str.trim();
                        // Bỏ toàn bộ dấu chấm, dấu chấm than, dấu hỏi cuối câu
                        str = str.replace(/[.?!]+$/, '');
                        if (str.length > 0) str = str[0].toLowerCase() + str.slice(1);
                        return str.toLowerCase();
                    };
                    let userNorm = normalize(userVal);
                    let correctNorm = normalize(String(correctVal));
                    isCorrect = userNorm === correctNorm;
                } else if (Array.isArray(correctVal)) {
                    isCorrect = correctVal.some(val => userVal.toLowerCase() === val.toLowerCase());
                } else if (String(correctVal) === 'Ø') {
                    // Chấp nhận cả khi học sinh để trống hoặc nhập 'Ø'
                    isCorrect = userVal === '' || userVal.toLowerCase() === 'ø';
                } else {
                    isCorrect = userVal.toLowerCase() === String(correctVal).toLowerCase();
                }
                if (isCorrect) {
                    inp.style.background = '#d4edda'; // green
                    inp.style.color = '#155724';
                    if (key.startsWith('f')) part2Correct++;
                    else if (key.startsWith('e')) part3Correct++;
                    else if (key.startsWith('c')) part4Correct++;
                } else {
                    inp.style.background = '#f8d7da'; // red
                    inp.style.color = '#721c24';
                    showExplanation(key, inp);
                }
            }
        });

        // Tính điểm
        let score1 = (part1Correct * 0.2).toFixed(2);
        let score2 = (part2Correct * 0.2).toFixed(2);
        let score3 = (part3Correct * 0.3).toFixed(2);
        let score4 = (part4Correct * 0.3).toFixed(2);
        let total = (parseFloat(score1) + parseFloat(score2) + parseFloat(score3) + parseFloat(score4)).toFixed(2);
        document.getElementById('score-result').innerHTML = `<span style='font-size:1.2em;'>Tổng điểm: <b>${Number(total).toFixed(1)}/10</b></span>`;
        // Custom popup
        const modal = document.getElementById('score-modal');
        const modalMsg = document.getElementById('score-modal-message');
        const modalScore = document.getElementById('score-modal-score');
        let scoreColor = parseFloat(total) >= 7 ? '#1ca01c' : '#d94d00';
        let labelColor = scoreColor;
        modalScore.innerHTML = `<span style='font-size:1em;font-weight:bold;color:${labelColor};display:block;'>Số điểm của bạn là:</span><span style='font-size:2.2em;font-weight:bold;color:${scoreColor};display:block;'>${Number(total).toFixed(1)}/10</span>`;
        if (parseFloat(total) >= 7) {
            modalMsg.textContent = `Chúc mừng bạn đã đạt yêu cầu bài kiểm tra!`;
        } else {
            modalMsg.textContent = `Bạn chưa đạt yêu cầu bài kiểm tra, hãy luyện tập thêm nhé!`;
        }
        modal.style.display = 'flex';
        // Đóng modal khi bấm nút hoặc click ra ngoài
        document.getElementById('score-modal-close').onclick = function() { modal.style.display = 'none'; };
        modal.onclick = function(e) { if (e.target === modal) modal.style.display = 'none'; };
    });
    </script>
</body>
</html>