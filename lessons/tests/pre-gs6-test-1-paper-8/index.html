<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRE GRADE 6 - ENGLISH GRAMMAR TEST 1 – (PAPER 8)</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background: #fff;
            color: #222;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 700px;
            margin: 30px auto;
            background: #fff;
            padding: 32px 32px 24px 32px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.07);
        }
        .main-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-align: center;
            color: #1743b3;
        }
        .info {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .info strong {
            font-weight: bold;
        }
        .section-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-top: 2rem;
            margin-bottom: 0.5rem;
        }
        .section-title .vi {
            font-weight: bold;
        }
        .section-title .en {
            font-style: italic;
            font-weight: normal;
        }
        .section-desc {
            font-style: italic;
            margin-bottom: 1rem;
        }
        .question {
            margin-bottom: 1.2rem;
        }
        .question strong {
            font-weight: bold;
        }
        .answers {
            margin-left: 2.2em;
            margin-top: 0.3em;
        }
        .answers label {
            display: block;
            margin-bottom: 0.2em;
            cursor: pointer;
            font-weight: normal;
        }
        .answers input[type="radio"] {
            margin-right: 8px;
        }
        .blank, .cloze-input {
            border: none;
            border-bottom: 1px solid #888;
            min-width: 60px;
            display: inline-block;
            text-align: center;
            font-size: 1em;
            margin: 0 2px;
            background: #fff;
        }
        .error-input {
            border: none;
            border-bottom: 1px solid #888;
            font-size: 1em;
            width: 75%;
            padding: 2px 4px;
            text-align: left;
            background: #fff;
            margin-left: 5px;
        }
        .student-name {
            border: none;
            border-bottom: 1px solid #222;
            min-width: 200px;
            font-size: 1em;
            background: #fff;
        }
        .error-correct {
            margin-left: 2.2em;
            margin-top: 0.3em;
        }
        .submit-btn {
            font-size:1.1em;
            padding: 0.6em 2em;
            background:#1743b3;
            color:#fff;
            border:none;
            border-radius:5px;
            cursor:pointer;
            margin-top:2.5rem;
            display: inline-block;
        }
        .submit-wrap {
            text-align:center;
        }
        .error-question {
            margin-bottom: 1.6rem;
        }
        .cloze-paragraph {
            line-height: 1.8;
        }
        .correct-line {
            margin-top: 0.5rem; /* Increased spacing */
        }
        .explanation-text {
            display: block;
            color: #d94d00;
            font-style: italic;
            font-size: 0.9em;
            margin-top: 0.4em;
        }
        @media (max-width: 600px) {
            .container {
                max-width: 100vw !important;
                margin: 0 !important;
                padding: 0 14px !important;
                border-radius: 0 !important;
                box-shadow: none !important;
            }
            .main-title {
                font-size: 1rem !important;
                text-align: center !important;
                margin-bottom: 1em !important;
                color: #1743b3 !important;
                font-weight: bold !important;
            }
            .info, .section-title, .section-desc {
                font-size: 0.95rem !important;
                text-align: center !important;
            }
            .section-title {
                margin-top: 1.2em !important;
                margin-bottom: 0.5em !important;
                font-weight: bold !important;
            }
            .section-desc {
                margin-bottom: 1em !important;
            }
            .question {
                font-size: 0.93rem !important;
                margin-bottom: 0.8rem !important;
                padding-left: 0.1em !important;
                padding-right: 0.1em !important;
            }
            .answers {
                margin-left: 0 !important;
                margin-top: 0.2em !important;
            }
            .answers label {
                display: flex !important;
                align-items: center !important;
                font-size: 0.93rem !important;
                margin-bottom: 0.3em !important;
                padding: 0.15em 0 0.15em 0.1em !important;
                border-radius: 0 !important;
                background: none !important;
                font-weight: normal !important;
                cursor: pointer !important;
                border: none !important;
                width: 100% !important;
                box-sizing: border-box !important;
            }
            .answers input[type="radio"] {
                width: 1em !important;
                height: 1em !important;
                accent-color: #1743b3 !important;
                margin-right: 8px !important;
                flex-shrink: 0 !important;
            }
            .blank, .cloze-input, .error-input, .student-name {
                min-width: 40px !important;
                font-size: 0.93em !important;
                width: 90% !important;
                box-sizing: border-box !important;
                margin-bottom: 5px !important;
                border-radius: 3px !important;
            }
            .submit-btn {
                font-size: 0.98em !important;
                padding: 0.7em 1.2em !important;
                width: 100% !important;
                margin-top: 1em !important;
                border-radius: 5px !important;
                background: #1743b3 !important;
                color: #fff !important;
                font-weight: bold !important;
                border: none !important;
                letter-spacing: 0.5px !important;
                display: block !important;
            }
            .submit-btn:hover, .submit-btn:focus {
                background: #0d2e7a !important;
            }
            .submit-wrap {
                padding: 0 !important;
            }
            #score-modal-content {
                width: 98vw !important;
                max-width: 99vw !important;
                padding: 1em 0.2em 1em 0.2em !important;
                font-size: 0.98em !important;
            }
            #score-modal-score {
                font-size: 1.2em !important;
            }
            #score-modal-message {
                font-size: 0.95em !important;
            }
        }
        #score-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.35);
            align-items: center;
            justify-content: center;
        }
        #score-modal-content {
            background: #fff;
            padding: 2em 1.5em 1.5em 1.5em;
            border-radius: 16px;
            max-width: 90vw;
            width: 350px;
            box-shadow: 0 4px 32px rgba(0,0,0,0.18);
            text-align: center;
            position: relative;
        }
        #score-modal-close {
            position: absolute;
            top: 10px;
            right: 18px;
            font-size: 1.5em;
            cursor: pointer;
        }
        #score-modal-message {
            font-size: 1.15em;
            margin-bottom: 1.2em;
        }
        #score-modal-score {
            font-size: 2.2em;
            font-weight: bold;
            color: #d94d00;
            margin-bottom: 0.7em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-title">PRE GRADE 6 - ENGLISH GRAMMAR TEST 1 – (PAPER 8)</div>
        <div class="info">
            <strong>Time:</strong> 45 minutes | <strong>Full name:</strong> <input class="student-name" type="text" placeholder="">
        </div>

        <!-- Part 1: Multiple Choice -->
        <div class="section-title"><span class="vi">Phần 1: Trắc nghiệm (2 điểm)</span> - <span class="en">Multiple Choice (2 marks)</span></div>
        <div class="section-desc"><em>Chọn đáp án đúng nhất</em> (<span>Choose the best answer</span>):</div>
        <div class="question">
            1. Which of the following is <strong>uncountable</strong>?
            <div class="answers">
                <label><input type="radio" name="q1" value="A">A. juice</label>
                <label><input type="radio" name="q1" value="B">B. pencil</label>
                <label><input type="radio" name="q1" value="C">C. apple</label>
                <label><input type="radio" name="q1" value="D">D. chair</label>
            </div>
        </div>
        <div class="question">
            2. Choose the correct plural of <strong>tooth</strong>:
            <div class="answers">
                <label><input type="radio" name="q2" value="A">A. tooths</label>
                <label><input type="radio" name="q2" value="B">B. teeths</label>
                <label><input type="radio" name="q2" value="C">C. teeth</label>
                <label><input type="radio" name="q2" value="D">D. toothes</label>
            </div>
        </div>
        <div class="question">
            3. Which noun is <strong>countable</strong>?
            <div class="answers">
                <label><input type="radio" name="q3" value="A">A. bread</label>
                <label><input type="radio" name="q3" value="B">B. advice</label>
                <label><input type="radio" name="q3" value="C">C. egg</label>
                <label><input type="radio" name="q3" value="D">D. water</label>
            </div>
        </div>
        <div class="question">
            4. I bought ___ umbrella because it was raining.
            <div class="answers">
                <label><input type="radio" name="q4" value="A">A. a</label>
                <label><input type="radio" name="q4" value="B">B. an</label>
                <label><input type="radio" name="q4" value="C">C. the</label>
                <label><input type="radio" name="q4" value="D">D. Ø</label>
            </div>
        </div>
        <div class="question">
            5. That is ___ interesting idea!
            <div class="answers">
                <label><input type="radio" name="q5" value="A">A. a</label>
                <label><input type="radio" name="q5" value="B">B. an</label>
                <label><input type="radio" name="q5" value="C">C. the</label>
                <label><input type="radio" name="q5" value="D">D. Ø</label>
            </div>
        </div>
        <div class="question">
            6. ___ moon is very bright tonight.
            <div class="answers">
                <label><input type="radio" name="q6" value="A">A. A</label>
                <label><input type="radio" name="q6" value="B">B. An</label>
                <label><input type="radio" name="q6" value="C">C. The</label>
                <label><input type="radio" name="q6" value="D">D. Ø</label>
            </div>
        </div>
        <div class="question">
            7. Which pronoun replaces <strong>Tom and her</strong> as subject?
            <div class="answers">
                <label><input type="radio" name="q7" value="A">A. them</label>
                <label><input type="radio" name="q7" value="B">B. us</label>
                <label><input type="radio" name="q7" value="C">C. we</label>
                <label><input type="radio" name="q7" value="D">D. they</label>
            </div>
        </div>
        <div class="question">
            8. I saw Mary and gave the gift to ___.
            <div class="answers">
                <label><input type="radio" name="q8" value="A">A. she</label>
                <label><input type="radio" name="q8" value="B">B. her</label>
                <label><input type="radio" name="q8" value="C">C. him</label>
                <label><input type="radio" name="q8" value="D">D. them</label>
            </div>
        </div>
        <div class="question">
            9. The plural of <strong>man</strong> is:
            <div class="answers">
                <label><input type="radio" name="q9" value="A">A. mans</label>
                <label><input type="radio" name="q9" value="B">B. manes</label>
                <label><input type="radio" name="q9" value="C">C. men</label>
                <label><input type="radio" name="q9" value="D">D. mens</label>
            </div>
        </div>
        <div class="question">
            10. Which sentence is correct?
            <div class="answers">
                <label><input type="radio" name="q10" value="A">A. I need a egg for my sandwich.</label>
                <label><input type="radio" name="q10" value="B">B. I need an egg for my sandwich.</label>
                <label><input type="radio" name="q10" value="C">C. I need any eggs for my sanwich.</label>
                <label><input type="radio" name="q10" value="D">D. I need much eggs for my sandwich.</label>
            </div>
        </div>

        <!-- Part 2: Fill in the blanks -->
        <div class="section-title"><span class="vi">Phần 2: Điền từ (2 điểm)</span> - <span class="en">Fill in the blanks (2 marks)</span></div>
        <div class="section-desc"><em>Điền từ thích hợp vào chỗ trống</em> (<span>Fill in the blanks with appropriate words</span>):</div>
        <div class="question">1. I saw five <input class="blank" type="text" name="f1" autocomplete="off" placeholder=""> (child/children) at the playground.</div>
        <div class="question">2. There isn't <input class="blank" type="text" name="f2" autocomplete="off" placeholder=""> (some/any) juice in the bottle.</div>
        <div class="question">3. She wants <input class="blank" type="text" name="f3" autocomplete="off" placeholder=""> (a/an/some) orange.</div>
        <div class="question">4. My father gave <input class="blank" type="text" name="f4" autocomplete="off" placeholder=""> (I/me) a bicycle.</div>
        <div class="question">5. <input class="blank" type="text" name="f5" autocomplete="off" placeholder=""> (He/Him) is a good friend.</div>
        <div class="question">6. Anna and <input class="blank" type="text" name="f6" autocomplete="off" placeholder=""> (I/me) are classmates.</div>
        <div class="question">7. Can you help <input class="blank" type="text" name="f7" autocomplete="off" placeholder=""> (we/us), please?</div>
        <div class="question">8. I saw <input class="blank" type="text" name="f8" autocomplete="off" placeholder=""> (she/her) at the supermarket.</div>
        <div class="question">9. I want <input class="blank" type="text" name="f9" autocomplete="off" placeholder=""> (a/an/the/Ø) apple.</div>
        <div class="question">10. Look! <input class="blank" type="text" name="f10" autocomplete="off" placeholder=""> (a/an/the/Ø) stars are beautiful tonight.</div>

        <!-- Part 3: Error Correction -->
        <div class="section-title"><span class="vi">Phần 3: Tìm lỗi sai (3 điểm)</span> - <span class="en">Error Correction (3 marks)</span></div>
        <div class="section-desc"><em>Tìm lỗi sai và viết lại câu đúng</em> (<span>Find the error and rewrite the sentence correctly</span>):</div>
        <div class="question error-question">
            1. She bought two breads and an apple for lunch.<br>
            Correct: <input class="error-input" type="text" name="e1" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            2. I go to school by the bus every morning.<br>
            Correct: <input class="error-input" type="text" name="e2" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            3. Him and I are going to the zoo.<br>
            Correct: <input class="error-input" type="text" name="e3" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            4. They need an pencil to write.<br>
            Correct: <input class="error-input" type="text" name="e4" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            5. I saw many mouses in the room.<br>
            Correct: <input class="error-input" type="text" name="e5" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            6. There is an university in this city.<br>
            Correct: <input class="error-input" type="text" name="e6" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            7. He gave the book to she yesterday.<br>
            Correct: <input class="error-input" type="text" name="e7" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            8. My sister has the red bike.<br>
            Correct: <input class="error-input" type="text" name="e8" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            9. It takes me about a hour to go to school.<br>
            Correct: <input class="error-input" type="text" name="e9" autocomplete="off" placeholder="">
        </div>
        <div class="question error-question">
            10. My penfriend decided to go to the Vietnam to visit me.<br>
            Correct: <input class="error-input" type="text" name="e10" autocomplete="off" placeholder="">
        </div>

        <!-- Part 4: Cloze Test -->
        <div class="section-title"><span class="vi">Phần 4: Điền từ vào đoạn văn (3 điểm)</span> - <span class="en">Cloze Test (3 marks)</span></div>
        <div class="section-desc"><em>Điền từ thích hợp vào chỗ trống trong đoạn văn sau</em> (<span>Fill in the blanks with appropriate words</span>):</div>
        <div class="question cloze-paragraph">
            <strong>A.</strong> This morning, I went to <input class="cloze-input" type="text" name="c1" autocomplete="off" placeholder=""> (1) library with my friend. We borrowed <input class="cloze-input" type="text" name="c2" autocomplete="off" placeholder=""> (2) books and <input class="cloze-input" type="text" name="c3" autocomplete="off" placeholder=""> (3) dictionary. After that, we walked to <input class="cloze-input" type="text" name="c4" autocomplete="off" placeholder=""> (4) café, but there was not <input class="cloze-input" type="text" name="c5" autocomplete="off" placeholder=""> (5) food we liked.
        </div>
        <div class="question cloze-paragraph">
            <strong>B.</strong> Last weekend, I visited my cousin. He gave me <input class="cloze-input" type="text" name="c6" autocomplete="off" placeholder=""> (1) chocolate and <input class="cloze-input" type="text" name="c7" autocomplete="off" placeholder=""> (2) bottle of lemonade. <input class="cloze-input" type="text" name="c8" autocomplete="off" placeholder=""> (3) played with many toys in his room and then made <input class="cloze-input" type="text" name="c9" autocomplete="off" placeholder=""> (4) sandwiches together. It was a great day for <input class="cloze-input" type="text" name="c10" autocomplete="off" placeholder=""> (5)!
        </div>

        <div class="submit-wrap">
            <button class="submit-btn">Nộp bài / Submit</button>
            <div id="score-result" style="margin-top:1.5em;font-size:1.1em;font-weight:bold;color:#1743b3;"></div>
        </div>
    </div>
    <div id="score-modal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);align-items:center;justify-content:center;">
        <div id="score-modal-content" style="background:#fff;padding:2em 1.5em 1.5em 1.5em;border-radius:16px;max-width:90vw;width:350px;box-shadow:0 4px 32px rgba(0,0,0,0.18);text-align:center;position:relative;">
            <span id="score-modal-close" style="position:absolute;top:10px;right:18px;font-size:1.5em;cursor:pointer;">&times;</span>
            <div id="score-modal-message" style="font-size:1.15em;margin-bottom:1.2em;"></div>
            <div id="score-modal-score" style="font-size:2.2em;font-weight:bold;color:#d94d00;margin-bottom:0.7em;"></div>
        </div>
    </div>
    <script>
    const answers = {
        // Part 1
        q1: 'A', // juice is uncountable
        q2: 'C', // teeth is the plural of tooth
        q3: 'C', // egg is countable
        q4: 'B', // an umbrella
        q5: 'B', // an interesting idea
        q6: 'C', // the moon
        q7: 'D', // they (Tom and her)
        q8: 'B', // her
        q9: 'C', // men
        q10: 'B', // I need an egg for my sandwich
        // Part 2
        f1: 'children',
        f2: 'any',
        f3: 'an',
        f4: 'me',
        f5: 'He',
        f6: 'I',
        f7: 'us',
        f8: 'her',
        f9: 'an',
        f10: 'The',
        // Part 3
        e1: 'She bought two loaves of bread and an apple for lunch.',
        e2: 'I go to school by bus every morning.',
        e3: 'He and I are going to the zoo.',
        e4: 'They need a pencil to write.',
        e5: 'I saw many mice in the room.',
        e6: 'There is a university in this city.',
        e7: 'He gave the book to her yesterday.',
        e8: 'My sister has a red bike.',
        e9: 'It takes me about an hour to go to school.',
        e10: 'My penfriend decided to go to Vietnam to visit me.',
        // Part 4
        c1: 'the', c2: 'some', c3: 'a', c4: 'a', c5: 'any',
        c6: 'some', c7: 'a', c8: 'We', c9: 'some', c10: 'me',
    };

    const explanations = {
        // Part 1
        q1: "Đáp án đúng là: juice. 'Juice' là danh từ không đếm được, các đáp án còn lại là danh từ đếm được.",
        q2: "Đáp án đúng là: teeth. Số nhiều của 'tooth' là 'teeth'.",
        q3: "Đáp án đúng là: egg. 'Egg' là danh từ đếm được, các đáp án còn lại là không đếm được.",
        q4: "Đáp án đúng là: an. 'An umbrella' vì 'umbrella' bắt đầu bằng nguyên âm.",
        q5: "Đáp án đúng là: an. 'An interesting idea' vì 'interesting' bắt đầu bằng nguyên âm.",
        q6: "Đáp án đúng là: The. 'The moon' là duy nhất.",
        q7: "Đáp án đúng là: they. 'Tom and her' là chủ ngữ số nhiều, thay bằng 'they'.",
        q8: "Đáp án đúng là: her. 'Gave the gift to her' dùng đại từ tân ngữ.",
        q9: "Đáp án đúng là: men. Số nhiều của 'man' là 'men'.",
        q10: "Đáp án đúng là: I need an egg for my sandwich. Dùng 'an' trước 'egg'.",
        // Part 2
        f1: "Đáp án đúng là: children. Số nhiều của 'child' là 'children'.",
        f2: "Đáp án đúng là: any. Dùng 'any' trong câu phủ định (isn't any juice).",
        f3: "Đáp án đúng là: an. 'An orange' vì 'orange' bắt đầu bằng nguyên âm.",
        f4: "Đáp án đúng là: me. 'Me' là đại từ tân ngữ dùng sau 'gave'.",
        f5: "Đáp án đúng là: He. 'He' là đại từ chủ ngữ đứng đầu câu.",
        f6: "Đáp án đúng là: I. 'I' là đại từ chủ ngữ đi với 'Anna and I'.",
        f7: "Đáp án đúng là: us. 'Us' là đại từ tân ngữ dùng sau 'help'.",
        f8: "Đáp án đúng là: her. 'Her' là đại từ tân ngữ dùng sau 'saw'.",
        f9: "Đáp án đúng là: an. 'An apple' vì 'apple' bắt đầu bằng nguyên âm.",
        f10: "Đáp án đúng là: The. 'The stars' là xác định, chỉ các ngôi sao trên trời.",
        // Part 3
        e1: "Đáp án đúng là: She bought two loaves of bread and an apple for lunch. 'Bread' là danh từ không đếm được, dùng 'loaves of bread' để chỉ số lượng.",
        e2: "Đáp án đúng là: I go to school by bus every morning. Không dùng 'the' trước phương tiện giao thông khi nói chung.",
        e3: "Đáp án đúng là: He and I are going to the zoo. Chủ ngữ phải là 'He and I'.",
        e4: "Đáp án đúng là: They need a pencil to write. Dùng 'a' trước danh từ bắt đầu bằng phụ âm.",
        e5: "Đáp án đúng là: I saw many mice in the room. Số nhiều của 'mouse' là 'mice'.",
        e6: "Đáp án đúng là: There is a university in this city. 'University' phát âm bắt đầu bằng /ju:/ nên dùng 'a'.",
        e7: "Đáp án đúng là: He gave the book to her yesterday. 'Her' là đại từ tân ngữ dùng sau giới từ 'to'.",
        e8: "Đáp án đúng là: My sister has a red bike. Không dùng 'the' khi nói về vật chưa xác định hoặc không xác định.",
        e9: "Đáp án đúng là: It takes me about an hour to go to school. 'Hour' phát âm bắt đầu bằng nguyên âm nên dùng 'an'.",
        e10: "Đáp án đúng là: My penfriend decided to go to Vietnam to visit me. Không dùng 'the' trước tên quốc gia.",
        // Part 4
        c1: "Đáp án đúng là: the. (1) 'The library' đã xác định.",
        c2: "Đáp án đúng là: some. (2) 'Some books' - một vài quyển sách.",
        c3: "Đáp án đúng là: a. (3) 'A dictionary' - một quyển từ điển.",
        c4: "Đáp án đúng là: a. (4) 'A café' - một quán cà phê bất kỳ.",
        c5: "Đáp án đúng là: any. (5) Không có món ăn nào nên dùng 'any'.",
        c6: "Đáp án đúng là: some. (1) 'Some chocolate' - một ít sô cô la.",
        c7: "Đáp án đúng là: a. (2) 'A bottle' - một chai nước chanh.",
        c8: "Đáp án đúng là: We. (3) Chủ ngữ là 'We'.",
        c9: "Đáp án đúng là: some. (4) 'Some sandwiches' - một vài chiếc bánh mì.",
        c10: "Đáp án đúng là: me. (5) 'Me' là đại từ tân ngữ chỉ bản thân mình."
    };

    document.querySelector('.submit-btn').addEventListener('click', function(e) {
        e.preventDefault();
        // Clear previous results and explanations
        document.querySelectorAll('.answers label').forEach(lab => {
            lab.style.color = ''; lab.style.fontWeight = '';
        });
        document.querySelectorAll('.blank, .cloze-input, .error-input').forEach(inp => {
            inp.style.background = ''; inp.style.color = '';
        });
        document.querySelectorAll('.explanation-text').forEach(el => el.remove());
        document.getElementById('score-result').textContent = '';

        let part1Correct = 0, part2Correct = 0, part3Correct = 0, part4Correct = 0;

        const showExplanation = (key, element) => {
            if (explanations[key]) {
                const exp = document.createElement('span');
                exp.className = 'explanation-text';
                exp.textContent = explanations[key];
                element.parentNode.appendChild(exp);
            }
        };

        // Check Part 1: Multiple Choice
        for (let i = 1; i <= 10; i++) {
            const qName = 'q' + i;
            const correct = answers[qName];
            const checked = document.querySelector(`input[name="${qName}"]:checked`);
            if (checked) {
                if (checked.value.toLowerCase() === correct.toLowerCase()) {
                    checked.parentElement.style.color = 'green';
                    checked.parentElement.style.fontWeight = 'bold';
                    part1Correct++;
                } else {
                    checked.parentElement.style.color = 'red';
                    checked.parentElement.style.fontWeight = 'bold';
                    showExplanation(qName, checked.parentElement);
                }
            }
        }

        // Check Part 2, 3, 4: Inputs
        Object.keys(answers).forEach(key => {
            if (key.startsWith('f') || key.startsWith('e') || key.startsWith('c')) {
                const inp = document.querySelector(`[name="${key}"]`);
                if (!inp) return;
                let userVal = inp.value.trim().replace(/\s+/g, ' ');
                let correctVal = answers[key];
                let isCorrect = false;
                if (key.startsWith('e')) {
                    const normalize = str => {
                        str = str.trim();
                        // Bỏ toàn bộ dấu chấm, dấu chấm than, dấu hỏi cuối câu
                        str = str.replace(/[.?!]+$/, '');
                        if (str.length > 0) str = str[0].toLowerCase() + str.slice(1);
                        return str.toLowerCase();
                    };
                    let userNorm = normalize(userVal);
                    let correctNorm = normalize(String(correctVal));
                    isCorrect = userNorm === correctNorm;
                } else if (Array.isArray(correctVal)) {
                    isCorrect = correctVal.some(val => userVal.toLowerCase() === val.toLowerCase());
                } else if (String(correctVal) === 'Ø') {
                    // Chấp nhận cả khi học sinh để trống hoặc nhập 'Ø'
                    isCorrect = userVal === '' || userVal.toLowerCase() === 'ø';
                } else {
                    isCorrect = userVal.toLowerCase() === String(correctVal).toLowerCase();
                }
                if (isCorrect) {
                    inp.style.background = '#d4edda'; // green
                    inp.style.color = '#155724';
                    if (key.startsWith('f')) part2Correct++;
                    else if (key.startsWith('e')) part3Correct++;
                    else if (key.startsWith('c')) part4Correct++;
                } else {
                    inp.style.background = '#f8d7da'; // red
                    inp.style.color = '#721c24';
                    showExplanation(key, inp);
                }
            }
        });

        // Tính điểm
        let score1 = (part1Correct * 0.2).toFixed(2);
        let score2 = (part2Correct * 0.2).toFixed(2);
        let score3 = (part3Correct * 0.3).toFixed(2);
        let score4 = (part4Correct * 0.3).toFixed(2);
        let total = (parseFloat(score1) + parseFloat(score2) + parseFloat(score3) + parseFloat(score4)).toFixed(2);
        document.getElementById('score-result').innerHTML = `<span style='font-size:1.2em;'>Tổng điểm: <b>${Number(total).toFixed(1)}/10</b></span>`;
        // Custom popup
        const modal = document.getElementById('score-modal');
        const modalMsg = document.getElementById('score-modal-message');
        const modalScore = document.getElementById('score-modal-score');
        let scoreColor = parseFloat(total) >= 7 ? '#1ca01c' : '#d94d00';
        let labelColor = scoreColor;
        modalScore.innerHTML = `<span style='font-size:1em;font-weight:bold;color:${labelColor};display:block;'>Số điểm của bạn là:</span><span style='font-size:2.2em;font-weight:bold;color:${scoreColor};display:block;'>${Number(total).toFixed(1)}/10</span>`;
        if (parseFloat(total) >= 7) {
            modalMsg.textContent = `Chúc mừng bạn đã đạt yêu cầu bài kiểm tra!`;
        } else {
            modalMsg.textContent = `Bạn chưa đạt yêu cầu bài kiểm tra, hãy luyện tập thêm nhé!`;
        }
        modal.style.display = 'flex';
        // Đóng modal khi bấm nút hoặc click ra ngoài
        document.getElementById('score-modal-close').onclick = function() { modal.style.display = 'none'; };
        modal.onclick = function(e) { if (e.target === modal) modal.style.display = 'none'; };
    });
    </script>
</body>
</html>